var fs=require("fs");
var path=require("path");
var change=require("./pageChanger").change;
//var config=require("config/config.js");
var ROOT=__dirname+ '\\..';
//console.log()
function sendFileSave(filePath,res,chan) {
    try{
        filePath=decodeURIComponent(filePath);
    }
    catch(e)
    {
        res.statusCode=400;
        res.end("Bad Request");
        return
    }
    if(~filePath.indexOf('\0'))
    {
        res.statusCode=400;
        res.end("Bad Request");
        return
    }
    filePath=path.normalize(path.join(ROOT,filePath));
//    console.log(filePath);

    fs.stat(filePath,function(err,stats)
    {
        if(err||!stats.isFile()) {
           // console.log(err);
            res.statusCode=400;
            res.end("File not found");
            return;
        }
        sendFile(filePath,res,chan);

    })

}
function sendFile(filePath,res,chan) {
  // console.log(filePath);
    fs.readFile(filePath,function(err,content)
    {
        chan=chan||{};
        if(err) throw err;
        var str=content.toString();
        str=change(str,chan);
        res.end(str);
    })
}

module.exports.sendFileSave=sendFileSave;
//console.log(read(__filename));
